<!DOCTYPE html>
<html lang="ko">

<!--head.ejs파일로 다 옮겨놨음-->

<head>
    <%-include('head')%>
</head>

<body>
    <!-- test check for submitting the test -->
    <script src="script/useCookies.js"></script>
    <div id="page-transition"></div>
    <div class="fixed-elem">
        <div class="logo" id="backToTop">
            <img src="pics/Logo.svg" alt="B-Free" />
        </div>
        <div class="translation">
            <ul class="translation-options">
                <li class="translation-option" id="menu">
                    <svg width="57" height="40" viewBox="0 0 57 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle class="svg_comp" cx="5" cy="5" r="5" fill="#C4C4C4" />
                        <circle class="svg_comp" cx="5" cy="20" r="5" fill="#C4C4C4" />
                        <circle class="svg_comp" cx="5" cy="35" r="5" fill="#C4C4C4" />
                        <rect class="svg_comp" x="17" width="40" height="10" rx="5" fill="#C4C4C4" />
                        <rect class="svg_comp" x="17" y="15" width="40" height="10" rx="5" fill="#C4C4C4" />
                        <rect class="svg_comp" x="17" y="30" width="40" height="10" rx="5" fill="#C4C4C4" />
                    </svg>
                    <ul id="path-menu">
                        <li class="path" id="toTop">메인</li>
                        <li class="path" id="toMiddle">더 알아보기</li>
                        <li class="path" id="toBottom">결과</li>
                    </ul>
                </li>
                <li class="translation-option" id="kr">한국어</li>
                <li class="translation-option" id="en">En</li>
            </ul>
        </div>
    </div>
    <script src="./script/translation.js"></script>
    <div class="main main_top" id="main_top">
        <div class="top">
            <div class="img_container">
                <img class="main_image" id="firstImage" src="pics/Main1.jpg" alt="두 사람이 나란히 가는 사진">
            </div>
            <div class="text_container">
                <div class="large-text">
                    <div class="main_text">
                        <span>Barrier-Free</span>
                    </div>
                    <div class="main_text">
                        <span>B-Free</span>
                    </div>
                </div>
                <div class="small-text">
                    <div class="sub_text">
                        <span>편견과 차별 없는 동등한 세상을 꿈꿉니다.</span>
                    </div>
                </div>
            </div>
            <div class="btn-container">
                <button type="button" class="btn btn-lg custom-button" id="toBeforeTest">테스트
                    하러가기</button>
            </div>
        </div>
    </div>
    <script>
        gsap.timeline()
            .from('body', { duration: 0.5 }) // for loading
            .from('.large-text', { y: -100, opacity: 0, duration: 1 })
            .from('.small-text', { y: -100, opacity: 0, duration: 1 })
    </script>


    <!-- Before 인식개선 테스트 div -->
    <div class="main before_test test">
        <%-include('beforeTest')%>
            <div class="result-container" id="beforeResult">
                <div class="swiper-slide question-slide result">
                    <div class="question-container">
                        <h3>Result</h3>
                        <span>테스트 결과입니다. 몰랐던 것을 더 알아가보는 시간을 가져보아요.</span>
                        <div class="RS">
                            틀린 문제 : <br>
                            <%if(WrongBefore){%>
                                <% for(var i=0; i<JSON.parse(WrongBefore).length; i++){ %>
                                    <% if(JSON.parse(WrongBefore)[i] == 1){ %>
                                        <%=i+1%>번<br>
                                        <% if(i+1 === 1){ %>
                                            <p> 장애자의 자는 한자 者(놈 자)로서 사람을 낮춰서 부르는 뜻이 되어 부적절한 표현이며, 
                                                장애우의 우는 한자 友(벗 우)로서 장애를 가진 친구란 뜻이 됩니다.  
                                                그러므로 일반적으로 <b>장애인</b>이라고 사용하는 것이 올바른 표현입니다.</p> 
                                            <% } %>
                                        <% if(i+1 === 2){ %>
                                            <p>해당 문제의 해답은 '더 알아보기' 페이지의 <b>첫 번째 통계자료</b>를 통해 찾을 수 있습니다.</p><br>
                                            <% } %>
                                        <% if(i+1 === 3){ %>
                                            <p>해당 문제의 해답은 '더 알아보기' 페이지의 <b>두 번째 통계자료</b>를 통해 찾을 수 있습니다. </p><br>
                                            <% } %>
                                        <% if(i+1 === 4){ %>
                                            <p>해당 문제의 해답은 '더 알아보기' 페이지 하단의 <b>'뇌성마비 장애인과 친구가 될 수 있을까?'</b><br>
                                                영상을 통해 찾을 수 있습니다. </p> 
                                            <% } %>
                                        <% if(i+1 === 5){ %>
                                            <p>해당 문제의 해답은 '더 알아보기' 페이지의 <b>네 번째 통계자료</b>를 통해 찾을 수 있습니다. </p><br>
                                            <% } %>
                                        <% if(i+1 === 6){ %>
                                            <p>해당 문제의 해답은 '더 알아보기' 페이지의 <b>세 번째 통계자료</b>를 통해 찾을 수 있습니다. </p><br>
                                            <% } %>
                                        <% if(i+1 === 7){ %>
                                            <p>해당 문제의 해답은 '더 알아보기' 페이지의 <b>다섯 번째 통계자료</b>를 통해 찾을 수 있습니다. </p><br>
                                            <% } %>
                                    <% } %>
                                <% } %>
                            <%}%>
                        </div>
                        <button type="button" class="btn btn-submit btn-lg" id="transTomainMiddle">더 알아보기</button>
                    </div>
                </div>
            </div>
    </div>
    <script>
        checkSubmitTest();
        // test-swiper
        const beforeTest = new Swiper('#before-test-container', {
            // Optional parameters
            direction: 'horizontal',
            pagination: {
                el: '.swiper-pagination',
                clickable: true
            },
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev',
            },
            keyboard: {
                enabled: true,
                onlyInViewport: true,
            },
            threshold: 10
        })
    </script>

    <!-- 메인 중단 -->
    <div class="main main_middle" id="main_middle">
        <div id="main_middle_container">
            <div class="carousel-container">
                <div class="swiper-container" id="img-container">
                    <div class="img_comment"><span id="hide-comment" style="display: none">누구에게나 </span>평범한 일상입니다.</div>
                    <div id="carousel" class="swiper-wrapper">
                        <div class="swiper-slide img-slide">
                            <img class="carousel_img" src="pics/carousel/carousel-1-1.jpg">
                        </div>
                        <div class="swiper-slide img-slide">
                            <img class="carousel_img" src="pics/carousel/carousel-2-1.jpg">
                        </div>
                        <div class="swiper-slide img-slide">
                            <img class="carousel_img" src="pics/carousel/carousel-3-1.jpg">
                        </div>
                        <div class="swiper-slide img-slide">
                            <img class="carousel_img" src="pics/carousel/carousel-4-1.jpg">
                        </div>
                        <div class="swiper-slide img-slide">
                            <img class="carousel_img" src="pics/carousel/carousel-1-2.jpg">
                        </div>
                        <div class="swiper-slide img-slide">
                            <img class="carousel_img" src="pics/carousel/carousel-2-2.jpg">
                        </div>
                        <div class="swiper-slide img-slide">
                            <img class="carousel_img" src="pics/carousel/carousel-3-2.jpg">
                        </div>
                        <div class="swiper-slide img-slide">
                            <img class="carousel_img" src="pics/carousel/carousel-4-2.jpg">
                        </div>
                    </div>
                    <div class="swiper-pagination"></div>
                    <div class="swiper-button-prev"></div>
                    <div class="swiper-button-next"></div>
                </div>
            </div>

            <script>

                const imgContainers = gsap.utils.toArray('.swiper-slide.img-slide');
                imgContainers.forEach((img, i) => {
                    img.dataset.index = i + 1;
                })
                // swiper
                const swiper = new Swiper('#img-container', {
                    // Optional parameters
                    direction: 'horizontal',
                    pagination: {
                        el: '.swiper-pagination',
                        clickable: true
                    },
                    navigation: {
                        nextEl: '.swiper-button-next',
                        prevEl: '.swiper-button-prev',
                    },
                    autoplay: {
                        delay: 5000,
                    },
                    threshold: 10,
                    on: {
                        slideChangeTransitionEnd: () => {
                            let active = document.querySelector('.swiper-slide.img-slide.swiper-slide-active').dataset.index <= 4
                            console.log(active);
                            if (active) {
                                gsap.set('#hide-comment', { duration: 0, display: 'none' });
                            } else {
                                gsap.set('#hide-comment', { duration: 0, display: 'inline' });
                            }
                        }
                    }
                })

                gsap.registerPlugin(ScrollTrigger);
                gsap.from('.carousel-container', {
                    scrollTrigger: {
                        trigger: '.carousel-container',
                        toggleActions: 'play none none none'
                    },
                    y: 50,
                    duration: 1
                })


            </script>


            <!-- The first statistics : the number of the people with disability -->
            <div class="overlay">
                <div class="stat">
                    <div class="title">
                        <div class="number_container">
                            <div class="numbers">
                                <span class="number">5</span><span class="percentage">%</span>
                            </div>
                        </div>
                        <div class="headline">
                            <div class="text1">
                                20명 중 1명
                            </div>
                            <div class="text2">
                                우리나라의 장애인 추정수는 2,668,411명, 전체 인구의 약 5%
                            </div>
                        </div>
                    </div>
                    <div class="pict_container">
                        <div class="pictogram">
                            <div class="hover_icon" id="hover_icon1">
                                <div class="arrow"></div>
                                <div class="background" data-index="1">
                                    <div class="color_box_hover">

                                    </div>
                                    <div class="label_hover">
                                        장애를 가진 사람: 5.39%
                                    </div>
                                </div>
                            </div>
                            <div class="hover_icon" id="hover_icon2">
                                <div class="arrow"></div>
                                <div class="background" data-index="2">
                                    <div class="color_box_hover">
                                    </div>
                                    <div class="label_hover">
                                        장애를 가지지 않은 사람: 94.61%
                                    </div>
                                </div>
                            </div>
                            <div class="pictogram_controls">
                                <div class="control" data-index="1">
                                    <div class="color_box">

                                    </div>
                                    <div class="label">
                                        장애를 가진 사람
                                    </div>
                                </div>
                                <div class="control" data-index="2">
                                    <div class="color_box">

                                    </div>
                                    <div class="label">
                                        장애를 가지지 않은 사람
                                    </div>
                                </div>
                            </div>
                            <div class="img_people">
                                <img class="img_person img_person1" src="pics/human1.svg" alt="사람">
                                <img class="img_person img_person2" src="pics/human2.svg" alt="사람">
                                <img class="img_person img_person2" src="pics/human2.svg" alt="사람">
                                <img class="img_person img_person2" src="pics/human2.svg" alt="사람">
                                <img class="img_person img_person2" src="pics/human2.svg" alt="사람">
                                <img class="img_person img_person2" src="pics/human2.svg" alt="사람">
                                <img class="img_person img_person2" src="pics/human2.svg" alt="사람">
                                <img class="img_person img_person2" src="pics/human2.svg" alt="사람">
                                <img class="img_person img_person2" src="pics/human2.svg" alt="사람">
                                <img class="img_person img_person2" src="pics/human2.svg" alt="사람">
                            </div>
                            <div class="img_people">
                                <img class="img_person img_person2" src="pics/human2.svg" alt="사람">
                                <img class="img_person img_person2" src="pics/human2.svg" alt="사람">
                                <img class="img_person img_person2" src="pics/human2.svg" alt="사람">
                                <img class="img_person img_person2" src="pics/human2.svg" alt="사람">
                                <img class="img_person img_person2" src="pics/human2.svg" alt="사람">
                                <img class="img_person img_person2" src="pics/human2.svg" alt="사람">
                                <img class="img_person img_person2" src="pics/human2.svg" alt="사람">
                                <img class="img_person img_person2" src="pics/human2.svg" alt="사람">
                                <img class="img_person img_person2" src="pics/human2.svg" alt="사람">
                                <img class="img_person img_person2" src="pics/human2.svg" alt="사람">
                            </div>
                        </div>
                    </div>
                    <div class="source">
                        <span>
                            자료 출처 : 2017년 장애인 실태조사
                        </span>
                    </div>
                    <div class="comment">
                        우리 모두 함께 살아가고 있습니다. 보이지 않는다고 해서 없다고 생각하는 것은 편견이 될 수 있습니다.
                    </div>
                </div>
            </div>

            <!-- Second Statistic : the cause of the disability -->
            <div class="overlay">
                <div class="stat">
                    <div class="title">
                        <div class="number_container">
                            <div class="numbers">
                                <span class="number">9</span><span class="percentage">명</span>
                            </div>
                        </div>
                        <div class="headline">
                            <div class="text1">
                                10명 중 9명
                            </div>
                            <div class="text2">
                                장애 원인 중, 88.1%는 후천적 원인
                            </div>
                        </div>
                    </div>
                    <div class="pict_container">
                        <div class="pictogram">
                            <canvas id="chart1"></canvas>
                            <script>
                                let chart = new Chart(document.getElementById('chart1').getContext('2d'), getChartArguments()[0].chartConfig);
                            </script>
                        </div>
                    </div>
                    <div class="source">
                        <span>
                            자료 출처 : 2017년 장애인 실태조사
                        </span>
                    </div>
                    <div class="comment">
                        장애는 후천적인 원인이 훨씬 많습니다. 장애는 누구나 언제든 얻게 될 수 있습니다. 장애를 특별한 것이라고 바라보는 자세는 차별의 시선이 될 수 있습니다.
                    </div>
                </div>
            </div>

            <!-- The third statistics -->
            <div class="overlay">
                <div class="stat">
                    <div class="title">
                        <div class="number_container">
                            <div class="numbers">
                                <span class="number small">60.7</span><span class="percentage small">%</span>
                            </div>
                        </div>
                        <div class="headline">
                            <div class="text1">
                                절반 이상이 잘 알지 못합니다.
                            </div>
                            <div class="text2">
                                '모른다'라고 답한 비율, 60.7%
                            </div>
                        </div>
                    </div>
                    <div class="pict_container">
                        <div class="pictogram">
                            <canvas id="chart2"></canvas>
                            <script>
                                let chart2 = new Chart(document.getElementById('chart2').getContext('2d'), chartArguments[1].chartConfig);
                            </script>
                        </div>
                    </div>
                    <div class="source">
                        <span>
                            자료 출처 : 2017년 장애인 실태조사
                        </span>
                    </div>
                    <div class="comment">
                        2008년에 제정된 장애인 차별 금지법은 제정된지 13년이 지났습니다.
                        아직 장애인분들 중에서도 이 법에 대해서 잘 모르시는 분들이 많습니다.
                    </div>
                </div>
            </div>

            <!-- The Fourth statistic -->
            <div class="overlay">
                <div class="stat">
                    <div class="title">
                        <div class="number_container">
                            <div class="numbers">
                                <span class="number small">48.9</span><span class="percentage small">%</span>
                            </div>
                        </div>
                        <div class="headline">
                            <div class="text1">
                                우리나라의 장애 유형은 15가지
                            </div>
                            <div class="text2">
                                장애 유형별 중 지체 장애의 구성비, 48.9%
                            </div>
                        </div>
                    </div>
                    <div class="pict_container">
                        <div class="pictogram">
                            <canvas id="chart3"></canvas>
                            <script>
                                let chart3 = new Chart(document.getElementById('chart3').getContext('2d'), chartArguments[2].chartConfig);
                            </script>
                        </div>
                    </div>
                    <div class="source">
                        <span>
                            자료 출처 : 2017년 장애인 실태조사
                        </span>
                    </div>
                    <div class="comment">
                        우리나라의 장애 유형은 15가지로 나뉘어 집니다. 또한, 그중에 가장 많은 비율을 차지하는 장애 유형은 지체장애입니다.
                    </div>
                </div>
            </div>

            <!-- The fifth statistic -->
            <div class="overlay">
                <div class="stat">
                    <div class="title">
                        <div class="number_container">
                            <div class="numbers">
                                <span class="number">15</span><span class="percentage">배</span>
                            </div>
                        </div>
                        <div class="headline">
                            <div class="text1">
                                장애가 범죄의 원인이 될 수는 없습니다.
                            </div>
                            <div class="text2">
                                정신 장애인의 범죄율, 0.08%
                            </div>
                        </div>
                    </div>
                    <div class="pict_container">
                        <div class="pictogram">
                            <canvas id="chart4"></canvas>
                            <script>
                                let chart4 = new Chart(document.getElementById('chart4').getContext('2d'), chartArguments[3].chartConfig);
                            </script>
                        </div>
                    </div>
                    <div class="source">
                        <span>
                            자료 출처 : 2017년 대검찰청 범죄분석 보고서
                        </span>
                    </div>
                    <div class="comment">
                        장애가 범죄의 원인이 될 순 없습니다. 장애인이 범죄를 일으켰다고 해서 장애인은 범죄자라는 인식을 가져선 안됩니다. 통계적으로도 비장애인의 범죄율이 정신장애인의 범죄율보다
                        15배
                        높다고
                        조사되었습니다.
                    </div>
                </div>
            </div>

            <div class="btn-container" id="btn-after-test">
                <button type="button" class="btn btn-lg" id="toAfterTest">테스트 보러가기</button>
            </div>


            <!-- 회전초밥 div -->
            <div class="owl-carousel owl-theme owl-loaded">
                <div class="item">
                    <a href="https://www.youtube.com/watch?v=CdFqM5fekqI" target="_blank">
                        <img src="https://img.youtube.com/vi/CdFqM5fekqI/maxresdefault.jpg"></a>
                        <span class="tooltiptext">제1회 한국수어의 날</span>
                </div>
                <div class="item">
                    <a href="https://www.youtube.com/watch?v=XN2OC9UVVuA" target="_blank">
                        <img src="https://img.youtube.com/vi/XN2OC9UVVuA/maxresdefault.jpg"></a>
                        <span class="tooltiptext">장애 대학생이 동기&교수님 한테 진심으로 서운할 때</span>
                </div>
                <div class="item">
                    <a href="https://www.youtube.com/watch?v=LS4WS7V0Y_A" target="_blank">
                        <img src="https://img.youtube.com/vi/LS4WS7V0Y_A/maxresdefault.jpg"></a>
                        <span class="tooltiptext">들리지 않아도 랩, 댄스, 노래<br> 다 할 수 있어요. <br>청각장애 핸디래퍼 김지연</span>

                </div>
                <div class="item">
                    <a href="https://www.youtube.com/watch?v=MCZqR2VCP28" target="_blank">
                        <img src="https://img.youtube.com/vi/MCZqR2VCP28/maxresdefault.jpg"></a>
                        <span class="tooltiptext">침묵 속에 춤을 추는 <br> 청각 장애 발레리나 고아라</span>

                </div>
                <div class="item">
                    <a href="https://www.youtube.com/watch?v=REpjJyKifms" target="_blank">
                        <img src="https://img.youtube.com/vi/REpjJyKifms/maxresdefault.jpg"></a>
                        <span class="tooltiptext">천만 조회수 기록한 <br> '조용한 택시'...비머도 타봤습니다</span>

                </div>
                <div class="item">
                    <a href="https://www.youtube.com/watch?v=5gc4y9ExmHw" target="_blank">
                        <img src="https://img.youtube.com/vi/5gc4y9ExmHw/maxresdefault.jpg"></a>
                        <span class="tooltiptext">제40회 장애인의 날 기념 동영상</span>

                </div>
                <div class="item">
                    <a href="https://www.youtube.com/watch?v=kJrRzI0Tm80" target="_blank">
                        <img src="https://img.youtube.com/vi/kJrRzI0Tm80/maxresdefault.jpg"></a>
                        <span class="tooltiptext">시청각장애인식개선 <br> 캠페인 홍보영상</span>

                </div>
                <div class="item">
                    <a href="https://www.youtube.com/watch?v=6KER4bgyozg" target="_blank">
                        <img src="https://img.youtube.com/vi/6KER4bgyozg/maxresdefault.jpg"></a>
                        <span class="tooltiptext">😧 뇌성마비 장애인과 <br> 친구가 될 수 있을까?</span>

                </div>
            </div>

            <script src="./owlcarousel/owl.carousel.min.js"></script>
            <script type="text/javascript">
                var owl = $('.owl-carousel');
                owl.owlCarousel({
                    items: 4,
                    loop: true,
                    margin: 10,
                    video: true,
                    autoplay: true,
                    autoplayTimeout: 3000,
                    autoplayHoverPause: true
                });
                $('.owl-carousel').owlCarousel();
            </script>

        </div>
        <script>
            let overlay = gsap.utils.toArray('.overlay');
            overlay.forEach((ol, i) => {
                ol.dataset.colorIndex = i;

                gsap.from(ol, {
                    scrollTrigger: {
                        trigger: ol,
                        toggleActions: 'play reset play reset',
                        scroller: '.main_middle'
                    },
                    x: 50 * Math.pow(-1, i),
                    duration: 0.7
                })
            })
        </script>
    </div>


    <!-- After 인식개선 테스트 div -->
    <div class="main after_test test">
        <%-include('afterTest')%>

            <div class="result-container" id="afterResult">
                <div class="swiper-slide question-slide result">
                    <div class="question-container">
                        <h3>Result</h3>
                        <span>테스트 결과입니다.</span>
                        <div class="QS">
                            틀린 문제 : <br>
                            <%if(WrongAfter){%>
                                <% for(var i=0; i<JSON.parse(WrongAfter).length; i++){ %>
                                    <% if(JSON.parse(WrongAfter)[i] == 1){ %>
                                        <%=i+1%>번<br>
                                        <p>해당 문제의 해답은 ~~에서 찾아볼 수 있습니다.</p>
                                    <% } %>
                                <% } %>
                            <%}%>
                        </div>
                        <button type="button" class="btn btn-submit btn-lg" id="transTomainBottom">이동하기</button>
                    </div>
                </div>
            </div>
    </div>

    <script>
        checkSubmitTest();
        // test-swiper
        const afterTest = new Swiper('#after-test-container', {
            // Optional parameters
            direction: 'horizontal',
            pagination: {
                el: '.swiper-pagination',
                clickable: true
            },
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev',
            },
            keyboard: {
                enabled: true,
                onlyInViewport: true,
            },
            threshold: 10
        })
    </script>


    <div class="main main_bottom" id="main_bottom">
        <div class="chart-comment-container" id="score-comment-container">
            <div class="chart-comment" id="first-score-comment">🙌사용자님은</div>
            <div class="own-score chart-comment" id="before-own-score">
                <div class="test-first-score-comment" id="before-first-score-comment">첫 번째 테스트에서</div>
                <div class="test-second-score-comment" id="before-second-score-comment">
                    <span class="total-count">7</span>개 중 
                    <span class="correct-count" style="color: rgba(255, 206, 86, 1)">
                        <% if(BeforeScore) {%>
                            <%=BeforeScore%>
                        <% } %>
                    </span>개를
                </div>
            </div>
            <div class="own-score chart-comment" id="after-own-score">
                <div class="test-first-score-comment" id="after-first-score-comment">두 번째 테스트에서</div>
                <div class="test-second-score-comment" id="after-second-score-comment">
                    <span class="total-count">7</span>개 중 
                    <span class="correct-count" style="color: rgba(54, 162, 235, 1)">
                        <% if(AfterScore) {%>
                            <%=AfterScore%>
                        <% } %>
                    </span>개를
                </div>
            </div>
            <div class="chart-comment" id="last-score-comment">맞히셨습니다!</div>
        </div>

        <div class="chart-comment-container" id="propose-comment">
            다른 사용자분들의 결과도 확인해보세요!
        </div>
        <div class="score-chart-container">
            <div class="score-chart" id="first-chart">
                <div class="chart-title">
                    인식 개선 서비스 점수 분포
                </div>
                <div class="compareChart" id="beforeCompareChart">
                    <canvas id="beforeChart">
                        <p>Feedback Chart1-1</p>
                    </canvas>
                </div>
            </div>
            <!-- <div class="score-chart">
                <div class="compareChart" id="afterCompareChart">
                    <canvas id="afterChart">
                        <p>Feedback Chart1-2</p>
                    </canvas>
                </div>
            </div> -->
            <div class="score-chart" id="second-chart">
                <div class="chart-title">
                    인식 개선 서비스를 이용한 뒤의 점수 변화 비율
                </div>
                <div class="compareChart" id="increaseCompareChart">
                    <canvas id="increaseChart">
                        <p>Feedback Chart2</p>
                    </canvas>
                </div>
            </div>
        </div>
    </div>

    <script src="./script/chartUtil.js"></script>
    <script src="./script/pageTransition.js"></script>
    <!-- jquery -->
    <script src="https://code.jquery.com/jquery-3.6.0.js"
        integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>

    <script type="text/javascript">
        function checkOnlyOne(element) { //체크박스 한 개만 선택되도록 하는 함수
            var formN = element.name;
            var checkboxes = document.getElementsByName(formN);
            checkboxes.forEach((cb) => {
                cb.checked = false;
            })
            element.checked = true;
            // console.log(element.value);
        }

        //before test form 제출 시, 호출되는 함수
        function submitBefore() {
            $('#before-test-container').hide();
            $('#beforeResult').show();

            //serialize: form 태그내의 항목들을 자동으로 읽어와 queryString 형식으로 변환
            var queryString = $("form[name=before]").serialize();
            $.ajax({
                type: 'post',
                url: '/before',
                data: queryString,
                dataType: 'json',
                error: function (xhr, status, error) {
                    console.log(error);
                }
            });
        }

        //after test form 제출 시, 호출되는 함수
        function submitAfter() {
            $('#after-test-container').hide();
            $('#afterResult').show();

            var queryString = $("form[name=after]").serialize();
            $.ajax({
                type: 'post',
                url: '/after',
                data: queryString,
                dataType: 'json',
                error: function (xhr, status, error) {
                    console.log(error);
                }
            });
        }
    </script>

    <!-- socket communication -->
    <!-- socket.io -->
    <script src="/socket.io/socket.io.js"></script>
    <script>
        var count;
        var score;
        var socket = io();
        //이미 before, after test 모두 제출한 경우
        socket.on('alreadyAll', function (data) {
            alert("이미 모든 테스트를 제출하셨습니다!");
            console.log(data);
        });
        //before 테스트를 정상적으로 제출한 경우
        socket.on('completeBefore', function () {
            alert("정상적으로 제출되었습니다!");
            location.reload();
        });
        //이미 before test를 제출한 경우
        socket.on('alreadyBefore', function () {
            alert("이미 제출하셨습니다!");
        });
        //before test를 제출하지 않고, after test를 제출하려 한 경우
        socket.on('goBefore', function () {
            alert("서비스 초기에 보여진 테스트를 먼저 제출해주세요!");
        });
        //after 테스트를 정상적으로 제출한 경우
        socket.on('completeAfter', function (result) {
            alert("정상적으로 제출되었습니다!");
            location.reload();
            console.log(result);
            count = result.Count.count;
            score = result.Score;
            //feedback chart
            var beforeCtx = document.getElementById('beforeChart').getContext('2d');
            var increaseCtx = document.getElementById('increaseChart').getContext('2d');
            var beforeChart = new Chart(beforeCtx, getChart(score, count)[0]);
            var increaseChart = new Chart(increaseCtx, getChart(score, count)[1]);
        });

        function getChart(score, count) {
            return [
                {
                    type: 'line',
                    data: {
                        labels: [0, 1, 2, 3, 4, 5, 6, 7],
                        datasets: [{
                            label: '점수 분포 - 서비스 이용 전',
                            data: [score.b0, score.b1, score.b2, score.b3, score.b4, score.b5, score.b6, score.b7],
                            backgroundColor: 'rgba(255, 206, 86, 0.7)',
                            borderColor: 'rgba(255, 206, 86, 1)',
                            borderWidth: 1
                        },
                        {
                            label: '점수 분포 - 서비스 이용 후',
                            data: [score.a0, score.a1, score.a2, score.a3, score.a4, score.a5, score.a6, score.a7],
                            backgroundColor: 'rgba(54, 162, 235, 0.7)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            yAxes: [{
                                ticks: {
                                    beginAtZero: true
                                }
                            }]
                        },
                        legend: {
                            position: 'top',
                            onHover: () => { document.getElementById("beforeChart").style.cursor = 'pointer' },
                            onLeave: () => { document.getElementById("beforeChart").style.cursor = 'default' }
                        },
                        animation: {
                            duration: 1500
                        }
                    }
                },

                {
                    type: 'pie',
                    data: {
                        labels: ["점수 상승", "점수 하락"],
                        datasets: [{
                            label: '서비스 이용 후, 점수 변화 여부',
                            data: [score.increase, (count - score.increase)],
                            backgroundColor: [
                                "#48C9B0", "#E5E7E9"
                            ]
                        }]
                    },
                    options: {
                        legend: {
                            position: 'left',
                            onHover: () => { document.getElementById("increaseChart").style.cursor = 'pointer' },
                            onLeave: () => { document.getElementById("increaseChart").style.cursor = 'default' }
                        },
                        ticks: {
                            display: false
                        },
                        animation: {
                            duration: 2000
                        },
                        gridLines: {
                            display: true,
                            drawTicks: false
                        }
                    }
                }
            ]
        }

        //main bottom에서 새로고침 시, 서버에서 넘겨준 db data로 chart 생성
        $(function () {
            var Count = JSON.parse('<%-JSON.stringify(Count)%>');
            var Score = JSON.parse('<%-JSON.stringify(Score)%>');
            //feedback chart
            var beforeCtx = document.getElementById('beforeChart').getContext('2d');
            var increaseCtx = document.getElementById('increaseChart').getContext('2d');
            var beforeChart = new Chart(beforeCtx, getChart(Score, Count.count)[0]);
            var increaseChart = new Chart(increaseCtx, getChart(Score, Count.count)[1]);
        })
    </script>
</body>

</html>